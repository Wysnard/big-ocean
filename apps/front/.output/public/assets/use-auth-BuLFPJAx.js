import{r as K}from"./main-DCnvL1B2.js";var be={},ce={};const G=Object.create(null),q=e=>be||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?G:globalThis),T=new Proxy(G,{get(e,t){return q()[t]??G[t]},has(e,t){return t in q()||t in G},set(e,t,n){const r=q(!0);return r[t]=n,!0},deleteProperty(e,t){if(!t)return!1;const n=q(!0);return delete n[t],!0},ownKeys(){const e=q(!0);return Object.keys(e)}});function g(e,t){return typeof process<"u"&&ce?ce[e]??t:typeof Deno<"u"?Deno.env.get(e)??t:typeof Bun<"u"?Bun.env[e]??t:t}const V=1,_=4,N=8,v=24,le={eterm:_,cons25:_,console:_,cygwin:_,dtterm:_,gnome:_,hurd:_,jfbterm:_,konsole:_,kterm:_,mlterm:_,mosh:v,putty:_,st:_,"rxvt-unicode-24bit":v,terminator:v,"xterm-kitty":v},we=new Map(Object.entries({APPVEYOR:N,BUILDKITE:N,CIRCLECI:v,DRONE:N,GITEA_ACTIONS:v,GITHUB_ACTIONS:v,GITLAB_CI:N,TRAVIS:N})),Te=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function Ie(){if(g("FORCE_COLOR")!==void 0)switch(g("FORCE_COLOR")){case"":case"1":case"true":return _;case"2":return N;case"3":return v;default:return V}if(g("NODE_DISABLE_COLORS")!==void 0&&g("NODE_DISABLE_COLORS")!==""||g("NO_COLOR")!==void 0&&g("NO_COLOR")!==""||g("TERM")==="dumb")return V;if(g("TMUX"))return v;if("TF_BUILD"in T&&"AGENT_NAME"in T)return _;if("CI"in T){for(const{0:e,1:t}of we)if(e in T)return t;return g("CI_NAME")==="codeship"?N:V}if("TEAMCITY_VERSION"in T)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(g("TEAMCITY_VERSION"))!==null?_:V;switch(g("TERM_PROGRAM")){case"iTerm.app":return!g("TERM_PROGRAM_VERSION")||/^[0-2]\./.exec(g("TERM_PROGRAM_VERSION"))!==null?N:v;case"HyperTerm":case"MacTerm":return v;case"Apple_Terminal":return N}if(g("COLORTERM")==="truecolor"||g("COLORTERM")==="24bit")return v;if(g("TERM")){if(/truecolor/.exec(g("TERM"))!==null)return v;if(/^xterm-256/.exec(g("TERM"))!==null)return N;const e=g("TERM").toLowerCase();if(le[e])return le[e];if(Te.some(t=>t.exec(e)!==null))return _}return g("COLORTERM")?_:V}const U={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",fg:{red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m"}},se=["debug","info","success","warn","error"];function Ae(e,t){return se.indexOf(t)>=se.indexOf(e)}const Le={info:U.fg.blue,success:U.fg.green,warn:U.fg.yellow,error:U.fg.red,debug:U.fg.magenta},Ne=(e,t,n)=>{const r=new Date().toISOString();return n?`${U.dim}${r}${U.reset} ${Le[e]}${e.toUpperCase()}${U.reset} ${U.bright}[Better Auth]:${U.reset} ${t}`:`${r} ${e.toUpperCase()} [Better Auth]: ${t}`},Ue=e=>{const t="warn",n=Ie()!==1,r=(s,o,i=[])=>{if(!Ae(t,s))return;const f=Ne(s,o,n);{s==="error"?console.error(f,...i):s==="warn"?console.warn(f,...i):console.log(f,...i);return}};return{...Object.fromEntries(se.map(s=>[s,(...[o,...i])=>r(s,o,i)])),get level(){return t}}};Ue();function Pe(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,{code:t,message:n,toString:()=>t}]))}Pe({USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",INVALID_USER:"Invalid user",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"Invalid token",TOKEN_EXPIRED:"Token expired",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account.",CROSS_SITE_NAVIGATION_LOGIN_BLOCKED:"Cross-site navigation login blocked. This request appears to be a CSRF attack.",VERIFICATION_EMAIL_NOT_ENABLED:"Verification email isn't enabled",EMAIL_ALREADY_VERIFIED:"Email is already verified",EMAIL_MISMATCH:"Email mismatch",SESSION_NOT_FRESH:"Session is not fresh",LINKED_ACCOUNT_ALREADY_EXISTS:"Linked account already exists",INVALID_ORIGIN:"Invalid origin",INVALID_CALLBACK_URL:"Invalid callbackURL",INVALID_REDIRECT_URL:"Invalid redirectURL",INVALID_ERROR_CALLBACK_URL:"Invalid errorCallbackURL",INVALID_NEW_USER_CALLBACK_URL:"Invalid newUserCallbackURL",MISSING_OR_NULL_ORIGIN:"Missing or null Origin",CALLBACK_URL_REQUIRED:"callbackURL is required",FAILED_TO_CREATE_VERIFICATION:"Unable to create verification",FIELD_NOT_ALLOWED:"Field not allowed to be set",ASYNC_VALIDATION_NOT_SUPPORTED:"Async validation is not supported",VALIDATION_ERROR:"Validation Error",MISSING_FIELD:"Field is required",METHOD_NOT_ALLOWED_DEFER_SESSION_REQUIRED:"POST method requires deferSessionRefresh to be enabled in session config",BODY_MUST_BE_AN_OBJECT:"Body must be an object",PASSWORD_ALREADY_SET:"User already has a password set"});var H=class extends Error{constructor(e,t){super(e,t),this.name="BetterAuthError",this.message=e,this.stack=""}};function Ce(e){try{return(new URL(e).pathname.replace(/\/+$/,"")||"/")!=="/"}catch{throw new H(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function De(e){try{const t=new URL(e);if(t.protocol!=="http:"&&t.protocol!=="https:")throw new H(`Invalid base URL: ${e}. URL must include 'http://' or 'https://'`)}catch(t){throw t instanceof H?t:new H(`Invalid base URL: ${e}. Please provide a valid base URL.`,{cause:t})}}function Q(e,t="/api/auth"){if(De(e),Ce(e))return e;const n=e.replace(/\/+$/,"");return!t||t==="/"?n:(t=t.startsWith("/")?t:`/${t}`,`${n}${t}`)}function Me(e,t,n,r,s){if(e)return Q(e,t);{const o=T.BETTER_AUTH_URL||T.NEXT_PUBLIC_BETTER_AUTH_URL||T.PUBLIC_BETTER_AUTH_URL||T.NUXT_PUBLIC_BETTER_AUTH_URL||T.NUXT_PUBLIC_AUTH_URL||(T.BASE_URL!=="/"?T.BASE_URL:void 0);if(o)return Q(o,t)}if(typeof window<"u"&&window.location)return Q(window.location.origin,t)}const xe={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}},Fe={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},Be=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,fe={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},ke=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function qe(e){return e instanceof Date&&!isNaN(e.getTime())}function Ve(e){const t=ke.exec(e);if(!t)return null;const[,n,r,s,o,i,f,a,c,u,d]=t,h=new Date(Date.UTC(parseInt(n,10),parseInt(r,10)-1,parseInt(s,10),parseInt(o,10),parseInt(i,10),parseInt(f,10),a?parseInt(a.padEnd(3,"0"),10):0));if(c){const y=(parseInt(u,10)*60+parseInt(d,10))*(c==="+"?-1:1);h.setUTCMinutes(h.getUTCMinutes()+y)}return qe(h)?h:null}function je(e,t={}){const{strict:n=!1,warnings:r=!1,reviver:s,parseDates:o=!0}=t;if(typeof e!="string")return e;const i=e.trim();if(i.length>0&&i[0]==='"'&&i.endsWith('"')&&!i.slice(1,-1).includes('"'))return i.slice(1,-1);const f=i.toLowerCase();if(f.length<=9&&f in fe)return fe[f];if(!Be.test(i)){if(n)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(Fe).some(([a,c])=>{const u=c.test(i);return u&&r&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${a} pattern`),u})&&n)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(i,(c,u)=>{if(c==="__proto__"||c==="constructor"&&u&&typeof u=="object"&&"prototype"in u){r&&console.warn(`[better-json] Dropping "${c}" key to prevent prototype pollution`);return}if(o&&typeof u=="string"){const d=Ve(u);if(d)return d}return s?s(c,u):u})}catch(a){if(n)throw a;return e}}function $e(e,t={strict:!0}){return je(e,t)}let I=[],x=0;const j=4,Ee=e=>{let t=[],n={get(){return n.lc||n.listen(()=>{})(),n.value},lc:0,listen(r){return n.lc=t.push(r),()=>{for(let o=x+j;o<I.length;)I[o]===r?I.splice(o,j):o+=j;let s=t.indexOf(r);~s&&(t.splice(s,1),--n.lc||n.off())}},notify(r,s){let o=!I.length;for(let i of t)I.push(i,n.value,r,s);if(o){for(x=0;x<I.length;x+=j)I[x](I[x+1],I[x+2],I[x+3]);I.length=0}},off(){},set(r){let s=n.value;s!==r&&(n.value=r,n.notify(s))},subscribe(r){let s=n.listen(r);return r(n.value),s},value:e};return n},We=5,$=6,W=10;let Ge=(e,t,n,r)=>(e.events=e.events||{},e.events[n+W]||(e.events[n+W]=r(s=>{e.events[n].reduceRight((o,i)=>(i(o),o),{shared:{},...s})})),e.events[n]=e.events[n]||[],e.events[n].push(t),()=>{let s=e.events[n],o=s.indexOf(t);s.splice(o,1),s.length||(delete e.events[n],e.events[n+W](),delete e.events[n+W])}),He=1e3,Oe=(e,t)=>Ge(e,r=>{let s=t(r);s&&e.events[$].push(s)},We,r=>{let s=e.listen;e.listen=(...i)=>(!e.lc&&!e.active&&(e.active=!0,r()),s(...i));let o=e.off;return e.events[$]=[],e.off=()=>{o(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let i of e.events[$])i();e.events[$]=[]}},He)},()=>{e.listen=s,e.off=o}});function Je(e,t,n){let r=new Set(t).add(void 0);return e.listen((s,o,i)=>{r.has(i)&&n(s,o,i)})}const Ye=()=>typeof window>"u",Xe=(e,t,n,r)=>{const s=Ee({data:null,error:null,isPending:!0,isRefetching:!1,refetch:f=>o(f)}),o=async f=>new Promise(a=>{const c=typeof r=="function"?r({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):r;n(t,{...c,query:{...c?.query,...f?.query},async onSuccess(u){s.set({data:u.data,error:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await c?.onSuccess?.(u)},async onError(u){const{request:d}=u,h=typeof d.retry=="number"?d.retry:d.retry?.attempts,y=d.retryAttempt||0;h&&y<h||(s.set({error:u.error,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await c?.onError?.(u))},async onRequest(u){const d=s.get();s.set({isPending:d.data===null,data:d.data,error:null,isRefetching:!0,refetch:s.value.refetch}),await c?.onRequest?.(u)}}).catch(u=>{s.set({error:u,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch})}).finally(()=>{a(void 0)})});e=Array.isArray(e)?e:[e];let i=!1;for(const f of e)f.subscribe(async()=>{Ye()||(i?await o():Oe(s,()=>{const a=setTimeout(async()=>{i||(await o(),i=!0)},0);return()=>{s.off(),f.off(),clearTimeout(a)}}))});return s},z=Symbol.for("better-auth:broadcast-channel"),Ke=()=>Math.floor(Date.now()/1e3);var Qe=class{listeners=new Set;name;constructor(e="better-auth.message"){this.name=e}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}post(e){if(!(typeof window>"u"))try{localStorage.setItem(this.name,JSON.stringify({...e,timestamp:Ke()}))}catch{}}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=t=>{if(t.key!==this.name)return;const n=JSON.parse(t.newValue??"{}");n?.event!=="session"||!n?.data||this.listeners.forEach(r=>r(n))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}};function Z(e="better-auth.message"){return globalThis[z]||(globalThis[z]=new Qe(e)),globalThis[z]}const ee=Symbol.for("better-auth:focus-manager");var ze=class{listeners=new Set;subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setFocused(e){this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof document>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>{document.visibilityState==="visible"&&this.setFocused(!0)};return document.addEventListener("visibilitychange",e,!1),()=>{document.removeEventListener("visibilitychange",e,!1)}}};function de(){return globalThis[ee]||(globalThis[ee]=new ze),globalThis[ee]}const te=Symbol.for("better-auth:online-manager");var Ze=class{listeners=new Set;isOnline=typeof navigator<"u"?navigator.onLine:!0;subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}setOnline(e){this.isOnline=e,this.listeners.forEach(t=>t(e))}setup(){if(typeof window>"u"||typeof window.addEventListener>"u")return()=>{};const e=()=>this.setOnline(!0),t=()=>this.setOnline(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e,!1),window.removeEventListener("offline",t,!1)}}};function ne(){return globalThis[te]||(globalThis[te]=new Ze),globalThis[te]}const k=()=>Math.floor(Date.now()/1e3),et=5;function tt(e){const{sessionAtom:t,sessionSignal:n,$fetch:r,options:s={}}=e,o=s.sessionOptions?.refetchInterval??0,i=s.sessionOptions?.refetchOnWindowFocus??!0,f=s.sessionOptions?.refetchWhenOffline??!1,a={lastSync:0,lastSessionRequest:0,cachedSession:void 0},c=()=>f||ne().isOnline,u=E=>{if(!c())return;if(E?.event==="storage"){a.lastSync=k(),n.set(!n.get());return}const S=t.get(),l=()=>{a.lastSessionRequest=k(),r("/get-session").then(async b=>{let p=b.data,F=b.error||null;if(p?.needsRefresh)try{const B=await r("/get-session",{method:"POST"});p=B.data,F=B.error||null}catch{}const Y=p?.session&&p?.user?{session:p.session,user:p.user}:null;t.set({...S,data:Y,error:F}),a.lastSync=k(),n.set(!n.get())}).catch(()=>{})};if(E?.event==="poll"){l();return}if(E?.event==="visibilitychange"){if(k()-a.lastSessionRequest<et)return;a.lastSessionRequest=k()}if(E?.event==="visibilitychange"){l();return}(S?.data===null||S?.data===void 0)&&(a.lastSync=k(),n.set(!n.get()))},d=E=>{Z().post({event:"session",data:{trigger:E},clientId:Math.random().toString(36).substring(7)})},h=()=>{o&&o>0&&(a.pollInterval=setInterval(()=>{t.get()?.data&&u({event:"poll"})},o*1e3))},y=()=>{a.unsubscribeBroadcast=Z().subscribe(()=>{u({event:"storage"})})},R=()=>{i&&(a.unsubscribeFocus=de().subscribe(()=>{u({event:"visibilitychange"})}))},P=()=>{a.unsubscribeOnline=ne().subscribe(E=>{E&&u({event:"visibilitychange"})})};return{init:()=>{h(),y(),R(),P(),Z().setup(),de().setup(),ne().setup()},cleanup:()=>{a.pollInterval&&(clearInterval(a.pollInterval),a.pollInterval=void 0),a.unsubscribeBroadcast&&(a.unsubscribeBroadcast(),a.unsubscribeBroadcast=void 0),a.unsubscribeFocus&&(a.unsubscribeFocus(),a.unsubscribeFocus=void 0),a.unsubscribeOnline&&(a.unsubscribeOnline(),a.unsubscribeOnline=void 0),a.lastSync=0,a.lastSessionRequest=0,a.cachedSession=void 0},triggerRefetch:u,broadcastSessionUpdate:d}}function nt(e,t){const n=Ee(!1),r=Xe(n,"/get-session",e,{method:"GET"});return Oe(r,()=>{const s=tt({sessionAtom:r,sessionSignal:n,$fetch:e,options:t});return s.init(),()=>{s.cleanup()}}),{session:r,$sessionSignal:n}}function re(e){if(e===null||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in e?!1:Symbol.toStringTag in e?Object.prototype.toString.call(e)==="[object Module]":!0}function oe(e,t,n=".",r){if(!re(t))return oe(e,{},n,r);const s=Object.assign({},t);for(const o in e){if(o==="__proto__"||o==="constructor")continue;const i=e[o];i!=null&&(r&&r(s,o,i,n)||(Array.isArray(i)&&Array.isArray(s[o])?s[o]=[...i,...s[o]]:re(i)&&re(s[o])?s[o]=oe(i,s[o],(n?`${n}.`:"")+o.toString(),r):s[o]=i))}return s}function rt(e){return(...t)=>t.reduce((n,r)=>oe(n,r,"",e),{})}const st=rt();var ot=Object.defineProperty,it=Object.defineProperties,at=Object.getOwnPropertyDescriptors,he=Object.getOwnPropertySymbols,ut=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable,pe=(e,t,n)=>t in e?ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,A=(e,t)=>{for(var n in t||(t={}))ut.call(t,n)&&pe(e,n,t[n]);if(he)for(var n of he(t))ct.call(t,n)&&pe(e,n,t[n]);return e},L=(e,t)=>it(e,at(t)),lt=class extends Error{constructor(e,t,n){super(t||e.toString(),{cause:n}),this.status=e,this.statusText=t,this.error=n,Error.captureStackTrace(this,this.constructor)}},ft=async(e,t)=>{var n,r,s,o,i,f;let a=t||{};const c={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:a,hooks:c};for(const u of t?.plugins||[]){if(u.init){const d=await((n=u.init)==null?void 0:n.call(u,e.toString(),t));a=d.options||a,e=d.url}c.onRequest.push((r=u.hooks)==null?void 0:r.onRequest),c.onResponse.push((s=u.hooks)==null?void 0:s.onResponse),c.onSuccess.push((o=u.hooks)==null?void 0:o.onSuccess),c.onError.push((i=u.hooks)==null?void 0:i.onError),c.onRetry.push((f=u.hooks)==null?void 0:f.onRetry)}return{url:e,options:a,hooks:c}},ge=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},dt=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function ht(e){if(typeof e=="number")return new ge({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new ge(e);case"exponential":return new dt(e);default:throw new Error("Invalid retry strategy")}}var pt=async e=>{const t={},n=async r=>typeof r=="function"?await r():r;if(e?.auth){if(e.auth.type==="Bearer"){const r=await n(e.auth.token);if(!r)return t;t.authorization=`Bearer ${r}`}else if(e.auth.type==="Basic"){const[r,s]=await Promise.all([n(e.auth.username),n(e.auth.password)]);if(!r||!s)return t;t.authorization=`Basic ${btoa(`${r}:${s}`)}`}else if(e.auth.type==="Custom"){const[r,s]=await Promise.all([n(e.auth.prefix),n(e.auth.value)]);if(!s)return t;t.authorization=`${r??""} ${s}`}}return t},gt=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function _t(e){const t=e.headers.get("content-type"),n=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const r=t.split(";").shift()||"";return gt.test(r)?"json":n.has(r)||r.startsWith("text/")?"text":"blob"}function yt(e){try{return JSON.parse(e),!0}catch{return!1}}function ie(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function _e(e){try{return JSON.parse(e)}catch{return e}}function ye(e){return typeof e=="function"}function Et(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&ye(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&ye(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function Ot(e){const t=new Headers(e?.headers),n=await pt(e);for(const[r,s]of Object.entries(n||{}))t.set(r,s);if(!t.has("content-type")){const r=mt(e?.body);r&&t.set("content-type",r)}return t}function mt(e){return ie(e)?"application/json":null}function Rt(e){if(!e?.body)return null;const t=new Headers(e?.headers);if(ie(e.body)&&!t.has("content-type")){for(const[n,r]of Object.entries(e?.body))r instanceof Date&&(e.body[n]=r.toISOString());return JSON.stringify(e.body)}return t.has("content-type")&&t.get("content-type")==="application/x-www-form-urlencoded"&&ie(e.body)?new URLSearchParams(e.body).toString():e.body}function St(e,t){var n;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){const r=(n=e.split("@")[1])==null?void 0:n.split("/")[0];return Re.includes(r)?r.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function vt(e,t){let n;return!e?.signal&&e?.timeout&&(n=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:n,clearTimeout:()=>{n&&clearTimeout(n)}}}var bt=class me extends Error{constructor(t,n){super(n||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,me.prototype)}};async function J(e,t){const n=await e["~standard"].validate(t);if(n.issues)throw new bt(n.issues);return n.value}var Re=["get","post","put","patch","delete"],wt=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,n){var r,s,o,i;const f=((s=(r=e.plugins)==null?void 0:r.find(a=>{var c;return(c=a.schema)!=null&&c.config?t.startsWith(a.schema.config.baseURL||"")||t.startsWith(a.schema.config.prefix||""):!1}))==null?void 0:s.schema)||e.schema;if(f){let a=t;(o=f.config)!=null&&o.prefix&&a.startsWith(f.config.prefix)&&(a=a.replace(f.config.prefix,""),f.config.baseURL&&(t=t.replace(f.config.prefix,f.config.baseURL))),(i=f.config)!=null&&i.baseURL&&a.startsWith(f.config.baseURL)&&(a=a.replace(f.config.baseURL,""));const c=f.schema[a];if(c){let u=L(A({},n),{method:c.method,output:c.output});return n?.disableValidation||(u=L(A({},u),{body:c.input?await J(c.input,n?.body):n?.body,params:c.params?await J(c.params,n?.params):n?.params,query:c.query?await J(c.query,n?.query):n?.query})),{url:t,options:u}}}return{url:t,options:n}}}),Tt=e=>{async function t(n,r){const s=L(A(A({},e),r),{plugins:[...e?.plugins||[],wt(e||{}),...r?.plugins||[]]});if(e?.catchAllError)try{return await ae(n,s)}catch(o){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:o}}}return await ae(n,s)}return t};function It(e,t){const{baseURL:n,params:r,query:s}=t||{query:{},params:{},baseURL:""};let o=e.startsWith("http")?e.split("/").slice(0,3).join("/"):n||"";if(e.startsWith("@")){const d=e.toString().split("@")[1].split("/")[0];Re.includes(d)&&(e=e.replace(`@${d}/`,"/"))}o.endsWith("/")||(o+="/");let[i,f]=e.replace(o,"").split("?");const a=new URLSearchParams(f);for(const[d,h]of Object.entries(s||{})){if(h==null)continue;let y;if(typeof h=="string")y=h;else if(Array.isArray(h)){for(const R of h)a.append(d,R);continue}else y=JSON.stringify(h);a.set(d,y)}if(r)if(Array.isArray(r)){const d=i.split("/").filter(h=>h.startsWith(":"));for(const[h,y]of d.entries()){const R=r[h];i=i.replace(y,R)}}else for(const[d,h]of Object.entries(r))i=i.replace(`:${d}`,String(h));i=i.split("/").map(encodeURIComponent).join("/"),i.startsWith("/")&&(i=i.slice(1));let c=a.toString();return c=c.length>0?`?${c}`.replace(/\+/g,"%20"):"",o.startsWith("http")?new URL(`${i}${c}`,o):`${o}${i}${c}`}var ae=async(e,t)=>{var n,r,s,o,i,f,a,c;const{hooks:u,url:d,options:h}=await ft(e,t),y=Et(h),R=new AbortController,P=(n=h.signal)!=null?n:R.signal,m=It(d,h),M=Rt(h),E=await Ot(h),S=St(d,h);let l=L(A({},h),{url:m,headers:E,body:M,method:S,signal:P});for(const w of u.onRequest)if(w){const O=await w(l);typeof O=="object"&&O!==null&&(l=O)}("pipeTo"in l&&typeof l.pipeTo=="function"||typeof((r=t?.body)==null?void 0:r.pipe)=="function")&&("duplex"in l||(l.duplex="half"));const{clearTimeout:b}=vt(h,R);let p=await y(l.url,l);b();const F={response:p,request:l};for(const w of u.onResponse)if(w){const O=await w(L(A({},F),{response:(s=t?.hookOptions)!=null&&s.cloneResponse?p.clone():p}));O instanceof Response?p=O:typeof O=="object"&&O!==null&&(p=O.response)}if(p.ok){if(!(l.method!=="HEAD"))return{data:"",error:null};const O=_t(p),C={data:null,response:p,request:l};if(O==="json"||O==="text"){const D=await p.text(),ve=(o=l.jsonParser)!=null?o:_e;C.data=await ve(D)}else C.data=await p[O]();l?.output&&l.output&&!l.disableValidation&&(C.data=await J(l.output,C.data));for(const D of u.onSuccess)D&&await D(L(A({},C),{response:(i=t?.hookOptions)!=null&&i.cloneResponse?p.clone():p}));return t?.throw?C.data:{data:C.data,error:null}}const Y=(f=t?.jsonParser)!=null?f:_e,B=await p.text(),ue=yt(B),X=ue?await Y(B):null,Se={response:p,responseText:B,request:l,error:L(A({},X),{status:p.status,statusText:p.statusText})};for(const w of u.onError)w&&await w(L(A({},Se),{response:(a=t?.hookOptions)!=null&&a.cloneResponse?p.clone():p}));if(t?.retry){const w=ht(t.retry),O=(c=t.retryAttempt)!=null?c:0;if(await w.shouldAttemptRetry(O,p)){for(const D of u.onRetry)D&&await D(F);const C=w.getDelay(O);return await new Promise(D=>setTimeout(D,C)),await ae(e,L(A({},t),{retryAttempt:O+1}))}}if(t?.throw)throw new lt(p.status,p.statusText,ue?X:B);return{data:null,error:L(A({},X),{status:p.status,statusText:p.statusText})}};const At=(e,t)=>{const n="credentials"in Request.prototype,r=Me(e?.baseURL,e?.basePath)??"/api/auth",s=e?.plugins?.flatMap(l=>l.fetchPlugins).filter(l=>l!==void 0)||[],o={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:e?.fetchOptions?.onSuccess,onError:e?.fetchOptions?.onError,onRequest:e?.fetchOptions?.onRequest,onResponse:e?.fetchOptions?.onResponse}},{onSuccess:i,onError:f,onRequest:a,onResponse:c,...u}=e?.fetchOptions||{},d=Tt({baseURL:r,...n?{credentials:"include"}:{},method:"GET",jsonParser(l){return l?$e(l,{strict:!1}):null},customFetchImpl:fetch,...u,plugins:[o,...u.plugins||[],...e?.disableDefaultFetchPlugins?[]:[xe],...s]}),{$sessionSignal:h,session:y}=nt(d,e),R=e?.plugins||[];let P={};const m={$sessionSignal:h,session:y},M={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"},E=[{signal:"$sessionSignal",matcher(l){return l==="/sign-out"||l==="/update-user"||l==="/sign-up/email"||l==="/sign-in/email"||l==="/delete-user"||l==="/verify-email"||l==="/revoke-sessions"||l==="/revoke-session"||l==="/change-email"}}];for(const l of R)l.getAtoms&&Object.assign(m,l.getAtoms?.(d)),l.pathMethods&&Object.assign(M,l.pathMethods),l.atomListeners&&E.push(...l.atomListeners);const S={notify:l=>{m[l].set(!m[l].get())},listen:(l,b)=>{m[l].subscribe(b)},atoms:m};for(const l of R)l.getActions&&(P=st(l.getActions?.(d,S,e)??{},P));return{get baseURL(){return r},pluginsActions:P,pluginsAtoms:m,pluginPathMethods:M,atomListeners:E,$fetch:d,$store:S}};function Lt(e){return typeof e=="object"&&e!==null&&"get"in e&&typeof e.get=="function"&&"lc"in e&&typeof e.lc=="number"}function Nt(e,t,n){const r=t[e],{fetchOptions:s,query:o,...i}=n||{};return r||(s?.method?s.method:i&&Object.keys(i).length>0?"POST":"GET")}function Ut(e,t,n,r,s){function o(i=[]){return new Proxy(function(){},{get(f,a){if(typeof a!="string"||a==="then"||a==="catch"||a==="finally")return;const c=[...i,a];let u=e;for(const d of c)if(u&&typeof u=="object"&&d in u)u=u[d];else{u=void 0;break}return typeof u=="function"||Lt(u)?u:o(c)},apply:async(f,a,c)=>{const u="/"+i.map(E=>E.replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`)).join("/"),d=c[0]||{},h=c[1]||{},{query:y,fetchOptions:R,...P}=d,m={...h,...R},M=Nt(u,n,d);return await t(u,{...m,body:M==="GET"?void 0:{...P,...m?.body||{}},query:y||m?.query,method:M,async onSuccess(E){if(await m?.onSuccess?.(E),!s||m.disableSignal)return;const S=s.filter(b=>b.matcher(u));if(!S.length)return;const l=new Set;for(const b of S){const p=r[b.signal];if(!p)return;if(l.has(b.signal))continue;l.add(b.signal);const F=p.get();setTimeout(()=>{p.set(!F)},10)}}})}})}return o()}function Pt(e,t={}){const n=K.useRef(e.get()),{keys:r,deps:s=[e,r]}=t,o=K.useCallback(f=>{const a=c=>{n.current!==c&&(n.current=c,f())};return a(e.value),r?.length?Je(e,r,a):e.listen(a)},s),i=()=>n.current;return K.useSyncExternalStore(o,i,i)}function Ct(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Dt(e){return`use${Ct(e)}`}function Mt(e){const{pluginPathMethods:t,pluginsActions:n,pluginsAtoms:r,$fetch:s,$store:o,atomListeners:i}=At(e),f={};for(const[a,c]of Object.entries(r))f[Dt(a)]=()=>Pt(c);return Ut({...n,...f,$fetch:s,$store:o},s,t,r,i)}const xt=Mt({baseURL:"http://localhost:4000"}),{signUp:Ft,signIn:Bt,signOut:kt,useSession:qt,getSession:$t,updateUser:Wt,changeEmail:Gt,changePassword:Ht,forgetPassword:Jt,resetPassword:Yt,sendVerificationEmail:Xt,verifyEmail:Kt}=xt;function Vt(){const{data:e,isPending:t,error:n}=qt();return{session:e,user:e?.user??null,isAuthenticated:!!e?.user,isPending:t,error:n,signIn:{email:async(r,s)=>{const o=await Bt.email({email:r,password:s});if(o.error)throw new Error(o.error.message||"Sign in failed");return o.data}},signUp:{email:async(r,s,o,i)=>{const f=await Ft.email({email:r,password:s,name:o||r.split("@")[0],...i&&{anonymousSessionId:i}});if(f.error)throw new Error(f.error.message||"Sign up failed");return f.data}},signOut:async()=>{await kt()}}}function Qt(e="/login"){const{user:t,isAuthenticated:n,isPending:r}=Vt();return!r&&!n&&typeof window<"u"&&(window.location.href=e),{user:t,isAuthenticated:n,isPending:r}}export{Qt as a,Vt as u};
