import{S as T,s as E,h as M,g as I,n as O,a as L,r as l,b as $,d as A,c as R,j as e,R as K}from"./main-BDQEJz8h.js";import{c as b,B as N}from"./button-BMFwC-m0.js";var _=class extends T{#s;#n=void 0;#e;#t;constructor(s,t){super(),this.#s=s,this.setOptions(t),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const t=this.options;this.options=this.#s.defaultMutationOptions(s),E(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),t?.mutationKey&&this.options.mutationKey&&M(t.mutationKey)!==M(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(s){this.#r(),this.#o(s)}getCurrentResult(){return this.#n}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#r(),this.#o()}mutate(s,t){return this.#t=t,this.#e?.removeObserver(this),this.#e=this.#s.getMutationCache().build(this.#s,this.options),this.#e.addObserver(this),this.#e.execute(s)}#r(){const s=this.#e?.state??I();this.#n={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#o(s){O.batch(()=>{if(this.#t&&this.hasListeners()){const t=this.#n.variables,n=this.#n.context,r={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};if(s?.type==="success"){try{this.#t.onSuccess?.(s.data,t,n,r)}catch(a){Promise.reject(a)}try{this.#t.onSettled?.(s.data,null,t,n,r)}catch(a){Promise.reject(a)}}else if(s?.type==="error"){try{this.#t.onError?.(s.error,t,n,r)}catch(a){Promise.reject(a)}try{this.#t.onSettled?.(void 0,s.error,t,n,r)}catch(a){Promise.reject(a)}}}this.listeners.forEach(t=>{t(this.#n)})})}};function H(s,t){const n=L(),[r]=l.useState(()=>new _(n,s));l.useEffect(()=>{r.setOptions(s)},[r,s]);const a=l.useSyncExternalStore(l.useCallback(c=>r.subscribe(O.batchCalls(c)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),p=l.useCallback((c,d)=>{r.mutate(c,d).catch($)},[r]);if(a.error&&A(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:p,mutateAsync:a.mutate}}const F=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],v=R("loader-circle",F);const W=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],U=R("send",W);function C({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:b("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function P({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:b("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function k({className:s,...t}){return e.jsx("div",{"data-slot":"card-title",className:b("leading-none font-semibold",s),...t})}function S({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:b("px-6",s),...t})}const q="http://localhost:4000";async function z(s,t){const n=await fetch(`${q}${s}`,{...t,headers:{"Content-Type":"application/json",...t?.headers},credentials:"include"});if(!n.ok){const r=await n.json().catch(()=>({message:n.statusText}));throw new Error(r.message||`HTTP ${n.status}: ${n.statusText}`)}return n.json()}function B(){return H({mutationKey:["assessment","sendMessage"],mutationFn:async s=>z("/api/assessment/message",{method:"POST",body:JSON.stringify(s)})})}function D(s){const t={adventure:["That adventurous nature often correlates with high openness to experience. Do you find yourself seeking out novel experiences in other ways too?","I'm curious â€” when things don't go as planned during an adventure, how do you typically react?"],challenge:["Interesting. It sounds like you enjoy pushing yourself. How do you usually handle setbacks when pursuing these challenges?","Do you apply that same challenge-seeking approach to your personal and professional goals?"],creative:["Creativity is fascinating. How important is it for you to express your creative side in your daily life?","Do you see creativity as something essential to your happiness, or more as an occasional outlet?"],relationship:["Relationships are central to who we are. How would your close friends describe you?","Do you find it easy to open up to people, or do you prefer to keep things more private?"],work:["Work takes up a significant portion of our lives. What aspects of your work are most fulfilling?","Do you prefer structure and planning, or do you like more flexibility in how you approach tasks?"],default:["Tell me more about that. What draws you to this interest?","That's insightful. Do you find that this applies to other areas of your life as well?","I appreciate you sharing that. How would you say this shapes who you are?"]},n=s.toLowerCase();return n.includes("adventure")||n.includes("discover")||n.includes("explore")?t.adventure[Math.floor(Math.random()*t.adventure.length)]:n.includes("challenge")||n.includes("difficult")||n.includes("hard")?t.challenge[Math.floor(Math.random()*t.challenge.length)]:n.includes("create")||n.includes("creative")||n.includes("art")?t.creative[Math.floor(Math.random()*t.creative.length)]:n.includes("friend")||n.includes("relation")||n.includes("people")?t.relationship[Math.floor(Math.random()*t.relationship.length)]:n.includes("work")||n.includes("job")||n.includes("career")?t.work[Math.floor(Math.random()*t.work.length)]:t.default[Math.floor(Math.random()*t.default.length)]}function V(s){const[t,n]=l.useState([{id:"msg_init",role:"assistant",content:"Hi! I'm Nerin, your AI therapist. I'd like to understand you better. Let's start with something simple: What are you currently passionate about?",timestamp:new Date(Date.now()-5e3)}]),[r,a]=l.useState({openness:.58,conscientiousness:.42,extraversion:.55,agreeableness:.51,neuroticism:.38,opennessPrecision:58,conscientiousnessPrecision:42,extraversionPrecision:55,agreeablenessPrecision:51,neuroticismPrecision:38}),[p,c]=l.useState(!1),{mutate:d,isPending:f}=B(),x=l.useCallback(async h=>{if(!(!s||!h)){c(!0),n(o=>[...o,{id:`msg-${Date.now()}`,role:"user",content:h,timestamp:new Date}]);try{d({sessionId:s,message:h},{onSuccess:o=>{setTimeout(()=>{const i=o.response||D(h);n(u=>[...u,{id:`msg-${Date.now()}-response`,role:"assistant",content:i,timestamp:new Date}]),o.precision&&a({openness:o.precision.openness,conscientiousness:o.precision.conscientiousness,extraversion:o.precision.extraversion,agreeableness:o.precision.agreeableness,neuroticism:o.precision.neuroticism,opennessPrecision:Math.round(o.precision.openness*100),conscientiousnessPrecision:Math.round(o.precision.conscientiousness*100),extraversionPrecision:Math.round(o.precision.extraversion*100),agreeablenessPrecision:Math.round(o.precision.agreeableness*100),neuroticismPrecision:Math.round(o.precision.neuroticism*100)}),c(!1)},1e3+Math.random()*1e3)},onError:o=>{console.error("Failed to send message:",o);const i=D(h);n(u=>[...u,{id:`msg-${Date.now()}-response`,role:"assistant",content:i,timestamp:new Date}]),a(u=>{const g=Math.min(u.openness+Math.random()*.04,.95),m=Math.min(u.conscientiousness+Math.random()*.04,.95),y=Math.min(u.extraversion+Math.random()*.04,.95),w=Math.min(u.agreeableness+Math.random()*.04,.95),j=Math.min(u.neuroticism+Math.random()*.04,.95);return{openness:g,conscientiousness:m,extraversion:y,agreeableness:w,neuroticism:j,opennessPrecision:Math.round(g*100),conscientiousnessPrecision:Math.round(m*100),extraversionPrecision:Math.round(y*100),agreeablenessPrecision:Math.round(w*100),neuroticismPrecision:Math.round(j*100)}}),c(!1)}})}catch(o){console.error("Failed to send message:",o),c(!1)}}},[s,d]);return{messages:t,traits:r,isLoading:p||f,isCompleted:!1,sendMessage:x}}const J={opennessPrecision:"Openness",conscientiousnessPrecision:"Conscientiousness",extraversionPrecision:"Extraversion",agreeablenessPrecision:"Agreeableness",neuroticismPrecision:"Neuroticism"};function Q({sessionId:s}){const[t,n]=l.useState(""),r=l.useRef(null),{messages:a,traits:p,isLoading:c,isCompleted:d,sendMessage:f}=V(s);l.useEffect(()=>{r.current?.scrollIntoView({behavior:"smooth"})});const x=async()=>{!t.trim()||c||(await f(t),n(""))},h=async()=>{c||await f()},o=i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),x())};return e.jsxs("div",{className:"h-screen flex flex-col bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:[e.jsxs("div",{className:"bg-slate-800/50 border-b border-slate-700 px-6 py-4 shadow-sm backdrop-blur-sm",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"Big Five Personality Assessment"}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Session ID: ",e.jsx("code",{className:"bg-slate-700 px-2 py-1 rounded text-gray-300",children:s})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex gap-4 p-4",children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 mb-4",children:[a.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs(C,{className:"w-full max-w-md bg-slate-800/50 border-slate-700",children:[e.jsx(P,{children:e.jsx(k,{className:"text-center text-white",children:"Welcome to Personality Assessment"})}),e.jsxs(S,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300 text-center",children:"The AI therapist will ask you questions to evaluate your personality across five key dimensions. Ready to begin?"}),e.jsx(N,{onClick:h,disabled:c,className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:c?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),"Starting..."]}):"Start Assessment"})]})]})}):a.map(i=>e.jsx("div",{className:`flex ${i.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${i.role==="user"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"bg-slate-700/50 border border-slate-600 text-gray-100"}`,children:[e.jsx("p",{className:"text-sm",children:i.content}),e.jsx("p",{className:`text-xs mt-1 ${i.role==="user"?"text-blue-100":"text-gray-400"}`,children:i.timestamp?.toLocaleTimeString()||new Date(i.createdAt||"").toLocaleTimeString()})]})},i.id)),e.jsx("div",{ref:r})]}),e.jsx("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:t,onChange:i=>n(i.target.value),onKeyDown:o,placeholder:"Type your response here...",disabled:c||d,className:"flex-1 px-4 py-2 bg-slate-700 border border-slate-600 text-white rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed"}),e.jsx(N,{onClick:x,disabled:!t.trim()||c||d,size:"sm",className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:c?e.jsx(v,{className:"h-4 w-4 animate-spin"}):e.jsx(U,{className:"h-4 w-4"})})]})})]}),p&&e.jsx("div",{className:"w-80 flex flex-col",children:e.jsxs(C,{className:"bg-slate-800/50 border-slate-700",children:[e.jsx(P,{children:e.jsx(k,{className:"text-lg text-white",children:"Current Scores"})}),e.jsxs(S,{className:"space-y-4",children:[Object.entries(J).map(([i,u])=>{const g=p[i],m=Math.round(g*100),y=m>=90?"bg-green-500":m>=70?"bg-yellow-500":"bg-orange-500";return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:u}),e.jsxs("span",{className:"text-sm font-bold text-gray-100",children:[m,"%"]})]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${y}`,style:{width:`${m}%`}})})]},i)}),d]})]})})]})]})}function Y(){const{sessionId:s}=K.useSearch();return s?e.jsx(Q,{sessionId:s}):e.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"h-12 w-12 animate-spin text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Creating assessment session..."})]})})}export{Y as component};
