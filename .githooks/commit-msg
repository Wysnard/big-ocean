#!/bin/sh

# Commit message hook: Validates conventional commit format
# Format: type(scope): Description  or  type: Description
# Bypass with: git commit --no-verify

COMMIT_MSG_FILE="$1"
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Allow merge commits
if echo "$COMMIT_MSG" | grep -E "^Merge " > /dev/null; then
  exit 0
fi

# Allow conventional commits with optional scope
# Types: feat, fix, docs, chore, test, ci, refactor, perf, style, build, revert
if echo "$COMMIT_MSG" | grep -E "^(feat|fix|docs|chore|test|ci|refactor|perf|style|build|revert)(\(.+\))?:" > /dev/null; then
  exit 0
fi

echo ""
echo "‚ùå Commit message must follow conventional commit format!"
echo ""
echo "Format: type(scope): Description"
echo "    or: type: Description"
echo ""
echo "Types:"
echo "  - feat: A new feature"
echo "  - fix: A bug fix"
echo "  - docs: Documentation only changes"
echo "  - chore: Build process or auxiliary tool changes"
echo "  - test: Adding or modifying tests"
echo "  - ci: CI/CD configuration changes"
echo "  - refactor: Code restructuring without behavior changes"
echo "  - perf: Performance improvements"
echo "  - style: Code style/formatting changes"
echo "  - build: Build system or external dependencies"
echo "  - revert: Reverts a previous commit"
echo ""
echo "Examples:"
echo "  feat: Add user authentication"
echo "  fix(api): Resolve session timeout issue"
echo "  docs: Update README with setup instructions"
echo "  chore(deps): Update dependencies"
echo ""
echo "Bypass with: git commit --no-verify"
exit 1
